<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings discover v1.0.2</title>
  
<script defer>(()=>{"use strict";class e{constructor(t,a={}){a.context=this,this.$root=e.make(t,a)}static make(t,a={}){return t&&"object"==typeof a?a instanceof Node?a:e.config(document.createElement(t),a):null}static makeShadow(t,a={},i=null){if(!t||"object"!=typeof a)return null;let s=t instanceof Node?t:document.createElement(t);return s.attachShadow({mode:"open"}),e.config(s.shadowRoot,{context:a.context,children:[{tag:"style",textContent:i??""},a.child??{},...a.children??[]]}),delete a.children,delete a.child,e.config(s,a),s}static config(t,a){if(!(t instanceof Node)||"object"!=typeof a)return t;const i=a.context;let s=a=>{if(a)if(a instanceof Node)t.appendChild(a);else if(a instanceof e)t.appendChild(a.$root);else if("object"==typeof a){a.context||(a.context=i);let s=e.make(a.tag,a);s&&t.appendChild(s)}else"string"==typeof a&&(t.innerHTML+=a)};for(const[e,n]of Object.entries(a))if(n)switch(e){case"tag":case"context":continue;case"text":t.textContent=n;break;case"html":t.innerHTML=n;break;case"class":t.classList.add(...n.split(" "));break;case"also":i&&n.call(i,t);break;case"export":n[0]=t;break;case"var":i&&(i["$"+n]=t);break;case"events":for(let e in n)n[e]&&t.addEventListener(e,n[e].bind(i));break;case"parent":(n instanceof Node||n instanceof DocumentFragment)&&n.append(t);break;case"attrs":for(let e in n)t.setAttribute(e,n[e]);break;case"props":for(let e in n)t[e]=n[e];break;case"child":s(n);break;case"children":for(const e of n)s(e);break;case"style":if("string"==typeof n)t.style.cssText+=n+";";else for(let e in n)t.style[e]=n[e];break;default:t[e]=n}return t}static makeArray(t){return t&&Array.isArray(t)?t.map((t=>e.make(t.tag,t))):[]}}new Set,new Map;function t(){return new Promise((e=>{const t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;t||e(null);const a=new t({iceServers:[]});a.createDataChannel("",{reliable:!1}),a.addEventListener("icecandidate",(t=>{t.candidate&&t.candidate.address&&(t.candidate.address.endsWith(".local")?alert(`Disable WEB RTC anonymizer: ${navigator.userAgent.includes("Opera")||navigator.userAgent.includes("OPR")?"opera":navigator.userAgent.includes("Edg")?"edge":navigator.userAgent.includes("Chrome")?"chrome":navigator.userAgent.includes("Safari")?"safari":navigator.userAgent.includes("Firefox")?"firefox":navigator.userAgent.includes("MSIE")||1==!!document.documentMode?"IE":"unknown"}://flags/#enable-webrtc-hide-local-ips-with-mdns\r\n\r\nOr set local IP manually`):e(t.candidate.address)),e(null)})),a.createOffer().then((e=>a.setLocalDescription(e)))}))}const a={ru:{help:"\nНастрой маску подсети как в роутере (по умолч. 255.255.255.0) и жми обновить\n- Кнопка обновить: сканировать и найти новые устройства\n- Клик по устройству: открыть вебморду\n- Удерживать устройство: удалить его из списка",update:"Обновите библиотеку Settings на устройстве",remove:"Удалить"},en:{help:"\nSet subnet as in your router (default 255.255.255.0) and press refresh\n- Refresh button: scan and find new devices\n- Click device: open it\n- Hold device: remove it",update:"Update Settings library on device",remove:"Remove"}};let i=a.en;class s{timer=null;hold_trsh=1e3;ip=null;mac="";constructor(t,a,s,n){e.make("div",{context:this,var:"root",class:"device inactive",parent:t,children:[{tag:"div",children:[{tag:"span",var:"name",class:"name"},{tag:"span",var:"ipmac",class:"ipmac"}]},{tag:"div",class:"icon arrow"}],events:{click:()=>{this.ip&&!this.$root.classList.contains("inactive")&&window.open(`http://${this.ip}/`),console.log("click")},contextmenu:e=>{confirm(i.remove+" "+s+"?")&&(this.$root.dispatchEvent(new CustomEvent("remove",{detail:{mac:this.mac},bubbles:!0})),this.$root.remove()),e.preventDefault(),e.stopPropagation()}}}),this.mac=a,this.update(s,n)}update(e,t){this.ip=t,this.$name.textContent=e,this.$ipmac.textContent=t+" ["+this.mac+"]"}}class n{localIP=null;devices={};devices_obj={};searching=!1;constructor(){switch(e.make("div",{context:this,parent:document.body,var:"root",class:"main",children:[{tag:"div",class:"header",children:[{tag:"div",children:[{tag:"span",text:"Settings"},{tag:"span",class:"percent",var:"percent"}]},{tag:"div",class:"row",children:[{tag:"div",class:"col",children:[{tag:"span",class:"ip",var:"ip_label",text:"IP unset",events:{click:()=>{let e=prompt("Local IP",this.localIP);e&&(this.localIP=e,this.$ip_label.innerText=this.localIP,localStorage.setItem("ip",e))}}},{tag:"select",var:"subnet",class:"subnet",events:{change:()=>{localStorage.setItem("cidr",this.$subnet.value)}}}]},{tag:"div",class:"icon refresh",events:{click:()=>this.search()}}]}]},{tag:"div",class:"devices",var:"devices"}]}),document.body.classList=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{document.body.classList=e.matches?"dark":"light"})),this.$root.addEventListener("remove",(e=>{delete this.devices[e.detail.mac],delete this.devices_obj[e.detail.mac],localStorage.setItem("devices",JSON.stringify(this.devices))})),navigator.language||navigator.userLanguage){case"ru-RU":case"ru":i=a["ru"]}this.load()}async load(){setTimeout((()=>{localStorage.hasOwnProperty("first")||(localStorage.setItem("first","true"),alert(i.help))}),100),this.$subnet.innerHTML=function(){const e=[];for(let t=0;t<33;t++){let a;a=32==t?4294967295:~(4294967295>>>t),e.push(`${a>>>24&255}.${a>>>16&255}.${a>>>8&255}.${255&a}`)}return e}().map(((e,t)=>`<option value="${t}">${e}</option>`)).join(""),localStorage.hasOwnProperty("cidr")?this.$subnet.value=localStorage.getItem("cidr"):this.$subnet.value="24",localStorage.hasOwnProperty("ip")?this.localIP=localStorage.getItem("ip"):this.localIP=await t(),this.$ip_label.innerText=this.localIP?this.localIP:"IP error";let e=[];localStorage.hasOwnProperty("devices")&&(this.devices=JSON.parse(localStorage.getItem("devices")));for(const[t,a]of Object.entries(this.devices))this.devices_obj[t]=new s(this.$devices,t,a.name,a.ip),e.push(a.ip);c(e,(e=>this.addDevice(e)))}addDevice(e){let t=!1;if(e.mac in this.devices){this.devices_obj[e.mac].$root.classList="device";let a=this.devices[e.mac];a.ip==e.ip&&a.name==e.name||(this.devices_obj[e.mac].update(e.name,e.ip),a.ip=e.ip,a.name=e.name,t=!0)}else{if(!e.mac)return void alert(i.update+" "+e.name);this.devices[e.mac]={name:e.name,ip:e.ip},this.devices_obj[e.mac]=new s(this.$devices,e.mac,e.name,e.ip),this.devices_obj[e.mac].$root.classList="device",t=!0}t&&localStorage.setItem("devices",JSON.stringify(this.devices))}search(){this.searching||(this.searching=!0,c(function(e,t){t=Number(t);let a=e.split("."),i=a[0]<<24|a[1]<<16|a[2]<<8|a[3],s=~(4294967295>>>t),n=0,c=0,o=0,r=0;32===t?(n=i,c=n,o=n,r=n):(n=i&s,c=n+~s,31===t?(o=n,r=c):(o=n+1,r=c-1));let l=["192.168.4.1"];for(let e=o;e<=r;e++)l.push(`${e>>>24&255}.${e>>>16&255}.${e>>>8&255}.${255&e}`);return l}(this.localIP,this.$subnet.value),(e=>this.addDevice(e)),(e=>this.$percent.textContent=e+"%"),(()=>{this.$percent.textContent="",this.searching=!1})))}}async function c(e,t,a,i){for(let s in e)setTimeout((async()=>{a&&a(Math.round(s/e.length*100)),s==e.length-1&&i&&i();try{let a=await fetch(`http://${e[s]}/settings?action=discover`,{signal:AbortSignal.timeout(2500)});a&&a.ok&&(a=await a.json(),a.ip=e[s],t&&a.type&&"discover"===a.type&&t(a))}catch{}}),40*s)}document.addEventListener("DOMContentLoaded",(()=>{new n}))})();</script><style type="text/css">body,html{height:100%;margin:0;padding:0;width:100%}:root{--accent:#37a93c;--trsh:500px;--font_fam:Verdana,sans-serif;--error:#b61c1c}body.light{--dark:#ddd;--back:#f4f4f4;--tab:#fff;--font:#111;--font_tint:#777;--font_inv:#fff;--shadow:#00000012;--shadow_light:#00000007}body.dark{--dark:#000;--back:#1c1d22;--tab:#27272f;--font:#eaeaea;--font_tint:#a0a0a0;--font_inv:#000;--shadow:#00000049;--shadow_light:#00000022}body{background:var(--back);color:var(--font);font-family:var(--font_fam);-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}.main{box-sizing:border-box;margin:auto;max-width:500px;width:100%}.header{align-items:center;display:flex;font-size:19px;justify-content:space-between;padding:10px}.header .row{align-items:center;display:inline-flex}.header .col{display:inline-flex;flex-direction:column}.percent{display:inline-block;font-size:13px;padding-left:5px;transform:translateY(-8px)}.header .ip{cursor:pointer;font-size:15px}.subnet{background:var(--back);border:none;color:var(--font_tint);cursor:pointer;font-family:var(--font_fam);font-size:11px;margin:0;outline:none;padding:0}.subnet::-webkit-scrollbar{width:7px}.subnet::-webkit-scrollbar-track{display:none}.subnet::-webkit-scrollbar-thumb{background:var(--dark);border-radius:4px}.device{align-items:center;background:var(--tab);border-radius:10px;box-shadow:0 0 10px var(--shadow);cursor:pointer;display:flex;justify-content:space-between;margin:6px 10px;padding:8px;user-select:none}.device .name{display:block;font-size:19px}.device .ipmac{color:var(--font_tint);font-size:12px}.device.inactive{background:var(--back);color:var(--font_tint);cursor:default}.device.inactive>.arrow{display:none}.icon{background-color:var(--font);display:inline-block;height:30px;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-size:cover;mask-size:cover;width:30px}.icon.arrow{--svg:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-53 21 470 470'%3E%3Cpath d='M311 233c12 13 12 33 0 46L119 471a32 32 0 0 1-46-46l170-169L73 87a32 32 0 0 1 46-46z'/%3E%3C/svg%3E");height:22px;width:22px}.icon.refresh{--svg:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath d='M105 203a160 160 0 0 1 264-60l17 17h-34a32 32 0 1 0 0 64h112c18 0 32-14 32-32V80a32 32 0 1 0-64 0v35l-18-17a224 224 0 0 0-369 83 32 32 0 0 0 60 22m-66 86a32 32 0 0 0-23 31v112a32 32 0 1 0 64 0v-35l18 17a224 224 0 0 0 369-83 32 32 0 0 0-60-22 160 160 0 0 1-264 60l-17-17h34a32 32 0 1 0 0-64H48a39 39 0 0 0-9 1'/%3E%3C/svg%3E");cursor:pointer;margin-left:15px}</style></head>

<body></body>

</html>